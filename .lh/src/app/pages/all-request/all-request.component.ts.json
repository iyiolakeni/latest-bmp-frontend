{
    "sourceFile": "src/app/pages/all-request/all-request.component.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 18,
            "patches": [
                {
                    "date": 1734030494340,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1734030626704,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,8 +237,17 @@\n   this.showDialog = true;\r\n   this.data = request;\r\n }\r\n \r\n+approveModal(request: any): void {\r\n+  this.showDialog = true;\r\n+  this.accept = true;\r\n+  this.rejectForm.patchValue({\r\n+    approveNoOfPos: request.noOfPos\r\n+  })\r\n+  this.data = request;\r\n+}\r\n+\r\n closeModal(): void {\r\n   this.showDialog = false;\r\n }\r\n \r\n"
                },
                {
                    "date": 1734031986493,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -273,9 +273,9 @@\n \r\n approveRequest(): void {\r\n   const payload = {\r\n     status: 'approved',\r\n-    approveNoOfPos: this.rejectForm.value.approveNoOfPos,\r\n+    approvedNoOfPos: this.rejectForm.value.approveNoOfPos,\r\n     notes: this.rejectForm.value.notes,\r\n     approvedById: this.user.id\r\n   }\r\n this.subscriptions.push(\r\n"
                },
                {
                    "date": 1734032037214,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -54,9 +54,9 @@\n   private fb: FormBuilder\r\n ){\r\n   this.rejectForm = this.fb.group({\r\n     notes: [''],\r\n-    approveNoOfPos: ['']\r\n+    approvedNoOfPos: ['']\r\n   })\r\n }\r\n \r\n ngOnInit(){\r\n@@ -241,9 +241,9 @@\n approveModal(request: any): void {\r\n   this.showDialog = true;\r\n   this.accept = true;\r\n   this.rejectForm.patchValue({\r\n-    approveNoOfPos: request.noOfPos\r\n+    approvedNoOfPos: request.noOfPos\r\n   })\r\n   this.data = request;\r\n }\r\n \r\n@@ -273,9 +273,9 @@\n \r\n approveRequest(): void {\r\n   const payload = {\r\n     status: 'approved',\r\n-    approvedNoOfPos: this.rejectForm.value.approveNoOfPos,\r\n+    approvedNoOfPos: this.rejectForm.value.approvedNoOfPos,\r\n     notes: this.rejectForm.value.notes,\r\n     approvedById: this.user.id\r\n   }\r\n this.subscriptions.push(\r\n"
                },
                {
                    "date": 1734035041483,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,17 +101,27 @@\n \r\n getDeployedRequest(){\r\n   this.loading = true;\r\n   this.subscriptions.push(\r\n-    this.deployService.getAll().subscribe(\r\n-      (response: ApiResponse<[]>) => {\r\n-        this.allRequests = response;\r\n+    this.deployService.getAll( this.currentPage,\r\n+      this.itemsPerPage,\r\n+      this.sortBy = 'requestDate',\r\n+      this.sortDirection\r\n+    ).pipe(\r\n+      takeUntil(this.destroy$),\r\n+      finalize(() => this.loading = false)\r\n+    ).subscribe({\r\n+      next: (response: ApiResponse<[]>) => {\r\n+        this.allRequests = response.data.data;\r\n+        this.totalItems = response.data.data.length;\r\n         this.loading = false;\r\n       },\r\n-      (error) => {\r\n+      error: (error) => {\r\n         console.log(error);\r\n+        this.error = error.message;\r\n         this.loading = false\r\n-      })\r\n+      }\r\n+})\r\n   )\r\n }\r\n \r\n getApprovedRequest(){\r\n"
                },
                {
                    "date": 1734161823879,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,8 +208,9 @@\n   }\r\n }\r\n \r\n viewRequest(request: any): void {\r\n+  console.log(request);\r\n   this.dialog.open(FormComponent, {\r\n     width: '900px',\r\n       maxHeight: '90vh',\r\n       panelClass: 'custom-dialog-container',\r\n"
                },
                {
                    "date": 1734162188985,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,8 @@\n   }\r\n }\r\n \r\n viewRequest(request: any): void {\r\n-  console.log(request);\r\n   this.dialog.open(FormComponent, {\r\n     width: '900px',\r\n       maxHeight: '90vh',\r\n       panelClass: 'custom-dialog-container',\r\n"
                },
                {
                    "date": 1734162309016,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -78,9 +78,9 @@\n   this.subscriptions.push(\r\n     this.requestService.getAll(\r\n       this.currentPage,\r\n       this.itemsPerPage,\r\n-      this.sortBy = 'requestDate',\r\n+      this.sortBy = 'createdAt',\r\n       this.sortDirection\r\n     ).pipe(\r\n       takeUntil(this.destroy$),\r\n       finalize(() => this.loading = false)\r\n"
                },
                {
                    "date": 1734163673726,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,9 @@\n import { MatDialog } from '@angular/material/dialog';\r\n import { FormComponent } from '../../form/form.component';\r\n import { CreateFormComponent } from '../../create-form/create-form.component';\r\n import { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\n+import { DeployDialogComponent } from '../../deploy-dialog/deploy-dialog.component';\r\n \r\n \r\n @Component({\r\n   selector: 'app-all-request',\r\n@@ -229,9 +230,22 @@\n     this.getAllRequests();\r\n   })\r\n }\r\n \r\n+deployModal(request: any): void {\r\n+  const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n+    width: '900px',\r\n+      maxHeight: '90vh',\r\n+      panelClass: 'custom-dialog-container',\r\n+      data: {request, isView: false}\r\n+  })\r\n \r\n+  dialogRef.afterClosed().subscribe(result => {\r\n+    this.getAllRequests();\r\n+  })\r\n+}\r\n+\r\n+\r\n createRequest(): void {\r\n   const dialogRef = this.dialog.open(CreateFormComponent, {\r\n     width: '900px',\r\n       maxHeight: '90vh',\r\n"
                },
                {
                    "date": 1734164328504,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -232,9 +232,9 @@\n }\r\n \r\n deployModal(request: any): void {\r\n   const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n-    width: '900px',\r\n+    width: '50px',\r\n       maxHeight: '90vh',\r\n       panelClass: 'custom-dialog-container',\r\n       data: {request, isView: false}\r\n   })\r\n"
                },
                {
                    "date": 1734164338745,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -232,9 +232,9 @@\n }\r\n \r\n deployModal(request: any): void {\r\n   const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n-    width: '50px',\r\n+    width: '500px',\r\n       maxHeight: '90vh',\r\n       panelClass: 'custom-dialog-container',\r\n       data: {request, isView: false}\r\n   })\r\n"
                },
                {
                    "date": 1734164419293,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -232,9 +232,9 @@\n }\r\n \r\n deployModal(request: any): void {\r\n   const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n-    width: '500px',\r\n+    width: '900px',\r\n       maxHeight: '90vh',\r\n       panelClass: 'custom-dialog-container',\r\n       data: {request, isView: false}\r\n   })\r\n"
                },
                {
                    "date": 1734164490833,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -232,9 +232,9 @@\n }\r\n \r\n deployModal(request: any): void {\r\n   const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n-    width: '900px',\r\n+    width: '500px',\r\n       maxHeight: '90vh',\r\n       panelClass: 'custom-dialog-container',\r\n       data: {request, isView: false}\r\n   })\r\n"
                },
                {
                    "date": 1734164588823,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -234,8 +234,9 @@\n deployModal(request: any): void {\r\n   const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n     width: '500px',\r\n       maxHeight: '90vh',\r\n+      left: '30%',\r\n       panelClass: 'custom-dialog-container',\r\n       data: {request, isView: false}\r\n   })\r\n \r\n"
                },
                {
                    "date": 1734164610456,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -234,9 +234,8 @@\n deployModal(request: any): void {\r\n   const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n     width: '500px',\r\n       maxHeight: '90vh',\r\n-      left: '30%',\r\n       panelClass: 'custom-dialog-container',\r\n       data: {request, isView: false}\r\n   })\r\n \r\n"
                },
                {
                    "date": 1734165154684,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -232,9 +232,9 @@\n }\r\n \r\n deployModal(request: any): void {\r\n   const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n-    width: '500px',\r\n+    width: '900px',\r\n       maxHeight: '90vh',\r\n       panelClass: 'custom-dialog-container',\r\n       data: {request, isView: false}\r\n   })\r\n"
                },
                {
                    "date": 1734165223644,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -234,9 +234,9 @@\n deployModal(request: any): void {\r\n   const dialogRef = this.dialog.open(DeployDialogComponent, {\r\n     width: '900px',\r\n       maxHeight: '90vh',\r\n-      panelClass: 'custom-dialog-container',\r\n+      panelClass: 'dialog-container',\r\n       data: {request, isView: false}\r\n   })\r\n \r\n   dialogRef.afterClosed().subscribe(result => {\r\n"
                },
                {
                    "date": 1734166245505,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,9 +239,9 @@\n       data: {request, isView: false}\r\n   })\r\n \r\n   dialogRef.afterClosed().subscribe(result => {\r\n-    this.getAllRequests();\r\n+    this.getDeployedRequest();\r\n   })\r\n }\r\n \r\n \r\n"
                },
                {
                    "date": 1734168796992,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,8 +26,9 @@\n totalItems = 0;\r\n isView: boolean = false;\r\n data: any = {};\r\n rejectForm: FormGroup = new FormGroup({});\r\n+isLoading: boolean = false;\r\n \r\n readonly STATUS_COLORS: { [key: string]: string } = {\r\n   'pending': 'bg-yellow-100 text-yellow-800',\r\n   'deployed': 'bg-blue-100 text-blue-800',\r\n@@ -275,8 +276,9 @@\n   this.showDialog = false;\r\n }\r\n \r\n disapproveRequest(): void {\r\n+  this.isLoading = true;\r\n   const payload = {\r\n     status: 'rejected',\r\n     notes: this.rejectForm.value.notes,\r\n     approvedById: this.user.id\r\n@@ -286,17 +288,23 @@\n     (response) => {\r\n       this.getApprovedRequest();\r\n       this.data = {};\r\n       this.showDialog = false;\r\n+  this.isLoading = false;\r\n+\r\n     },\r\n     (error) => {\r\n       console.log(error);\r\n+  this.isLoading = false;\r\n+\r\n     }\r\n   )\r\n )\r\n }\r\n \r\n approveRequest(): void {\r\n+  this.isLoading = true;\r\n+\r\n   const payload = {\r\n     status: 'approved',\r\n     approvedNoOfPos: this.rejectForm.value.approvedNoOfPos,\r\n     notes: this.rejectForm.value.notes,\r\n@@ -307,11 +315,15 @@\n     (response) => {\r\n       this.getApprovedRequest();\r\n       this.data = {};\r\n       this.showDialog = false;\r\n+  this.isLoading = false;\r\n+\r\n     },\r\n     (error) => {\r\n       console.log(error);\r\n+  this.isLoading = false;\r\n+\r\n     }\r\n   )\r\n )\r\n }\r\n"
                }
            ],
            "date": 1734030494340,
            "name": "Commit-0",
            "content": "import { Component } from '@angular/core';\r\nimport { RequestsService } from '../../services/requests/requests.service';\r\nimport { SharedServiceService } from '../../services/shared-service/shared-service.service';\r\nimport { ApiResponse, UserResponse } from '../../interface/books.model';\r\nimport { finalize, Subject, Subscription, takeUntil } from 'rxjs';\r\nimport { ApproveRequestService } from '../../services/approve-request/approve-request.service';\r\nimport { DeployedTableService } from '../../services/deployed-table/deployed-table.service';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { FormComponent } from '../../form/form.component';\r\nimport { CreateFormComponent } from '../../create-form/create-form.component';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\n\r\n\r\n@Component({\r\n  selector: 'app-all-request',\r\n  templateUrl: './all-request.component.html',\r\n  styleUrl: './all-request.component.scss'\r\n})\r\nexport class AllRequestComponent {\r\nloading: boolean = false;\r\nuser!: UserResponse;\r\nerror: string = '';\r\ncurrentPage = 1;\r\nitemsPerPage = 10;\r\ntotalItems = 0;\r\nisView: boolean = false;\r\ndata: any = {};\r\nrejectForm: FormGroup = new FormGroup({});\r\n\r\nreadonly STATUS_COLORS: { [key: string]: string } = {\r\n  'pending': 'bg-yellow-100 text-yellow-800',\r\n  'deployed': 'bg-blue-100 text-blue-800',\r\n  'approved': 'bg-green-100 text-green-800',\r\n  'rejected': 'bg-red-100 text-red-800',\r\n  'delivered': 'bg-purple-100 text-purple-800'\r\n};\r\n\r\nsortDirection: 'asc' | 'desc' = 'desc';\r\nsortBy: 'createdAt' | 'updatedAt ' | 'requestDate' = 'createdAt';\r\nprivate subscriptions: Subscription[] = [];\r\nshowDialog: boolean = false;\r\naccept: boolean = false;\r\n\r\nprivate destroy$ = new Subject<void>();\r\n\r\nallRequests: any;\r\n\r\nconstructor(\r\n  private requestService: RequestsService,\r\n  private sharedService: SharedServiceService,\r\n  private approveService: ApproveRequestService,\r\n  private deployService: DeployedTableService,\r\n  public dialog: MatDialog,\r\n  private fb: FormBuilder\r\n){\r\n  this.rejectForm = this.fb.group({\r\n    notes: [''],\r\n    approveNoOfPos: ['']\r\n  })\r\n}\r\n\r\nngOnInit(){\r\n  this.user = this.sharedService.getUser()\r\n\r\n  if(this.user.jobPosition === 'Account Officer'){\r\n    this.getAllRequests();\r\n  }else if(this.user.jobPosition === 'Business Developer'){\r\n    this.getApprovedRequest();\r\n  }else{\r\n    this.getDeployedRequest();\r\n  }\r\n}\r\n\r\ngetAllRequests(\r\n){\r\n  this.loading = true;\r\n  this.error = '';\r\n  this.subscriptions.push(\r\n    this.requestService.getAll(\r\n      this.currentPage,\r\n      this.itemsPerPage,\r\n      this.sortBy = 'requestDate',\r\n      this.sortDirection\r\n    ).pipe(\r\n      takeUntil(this.destroy$),\r\n      finalize(() => this.loading = false)\r\n    ).subscribe({\r\n      next: (response: ApiResponse<[]>) => {\r\n        this.allRequests = response.data.data;\r\n        this.totalItems = response.data.data.length;\r\n        this.loading = false;\r\n      },\r\n      error: (error) => {\r\n        console.log(error);\r\n        this.error = error.message;\r\n        this.loading = false\r\n      }\r\n})\r\n  )\r\n}\r\n\r\ngetDeployedRequest(){\r\n  this.loading = true;\r\n  this.subscriptions.push(\r\n    this.deployService.getAll().subscribe(\r\n      (response: ApiResponse<[]>) => {\r\n        this.allRequests = response;\r\n        this.loading = false;\r\n      },\r\n      (error) => {\r\n        console.log(error);\r\n        this.loading = false\r\n      })\r\n  )\r\n}\r\n\r\ngetApprovedRequest(){\r\n  this.loading = true;\r\n  this.subscriptions.push(\r\n    this.approveService.getAll( this.currentPage,\r\n      this.itemsPerPage,\r\n      this.sortBy = 'requestDate',\r\n      this.sortDirection\r\n    ).pipe(\r\n      takeUntil(this.destroy$),\r\n      finalize(() => this.loading = false)\r\n    ).subscribe({\r\n      next: (response: ApiResponse<[]>) => {\r\n        this.allRequests = response.data.data;\r\n        this.totalItems = response.data.data.length;\r\n        this.loading = false;\r\n      },\r\n      error: (error) => {\r\n        console.log(error);\r\n        this.error = error.message;\r\n        this.loading = false\r\n      }\r\n})\r\n  )\r\n}\r\n\r\n// onSort(column: keyof any): void {\r\n//   // If same column, toggle direction\r\n//   if (this.sortColumn === column) {\r\n//     this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';\r\n//   } else {\r\n//     this.sortColumn = column;\r\n//     this.sortDirection = 'desc';\r\n//   }\r\n  \r\n  // Reload requests with new sorting\r\n//   this.getAllRequests();\r\n// }\r\n\r\n// Pagination methods\r\npreviousPage(): void {\r\n  if (this.currentPage > 1) {\r\n    this.currentPage--;\r\n    this.getAllRequests();\r\n  }\r\n}\r\n\r\nnextPage(): void {\r\n  const totalPages = Math.ceil(this.totalItems / this.itemsPerPage);\r\n  if (this.currentPage < totalPages) {\r\n    this.currentPage++;\r\n    this.getAllRequests();\r\n  }\r\n}\r\n\r\ngetMinValue(a: number, b: number): number {\r\n  return Math.min(a, b);\r\n}\r\n\r\ngetStatusClass(status: any['status']): string {\r\n  return this.STATUS_COLORS[status] || '';\r\n}\r\n\r\ngetFormattedDate(dateString: string): string {\r\n  try {\r\n    const date = new Date(dateString);\r\n    if (isNaN(date.getTime())) {\r\n      throw new Error('Invalid date');\r\n    }\r\n    const options: Intl.DateTimeFormatOptions = {\r\n      year: 'numeric',\r\n      month: '2-digit',\r\n      day: '2-digit',\r\n    };\r\n    const formattedDate = date\r\n      .toLocaleDateString('en-GB', options)\r\n      .replace(/\\//g, '-');\r\n\r\n    return formattedDate;\r\n  } catch (error) {\r\n    console.error('Error formatting date:', error);\r\n    return 'Invalid date';\r\n  }\r\n}\r\n\r\nviewRequest(request: any): void {\r\n  this.dialog.open(FormComponent, {\r\n    width: '900px',\r\n      maxHeight: '90vh',\r\n      panelClass: 'custom-dialog-container',\r\n      data: {request, isView: true}\r\n  })\r\n}\r\n\r\neditRequest(request: any): void {\r\n  const dialogRef = this.dialog.open(FormComponent, {\r\n    width: '900px',\r\n      maxHeight: '90vh',\r\n      panelClass: 'custom-dialog-container',\r\n      data: {request, isView: false}\r\n  })\r\n\r\n  dialogRef.afterClosed().subscribe(result => {\r\n    this.getAllRequests();\r\n  })\r\n}\r\n\r\n\r\ncreateRequest(): void {\r\n  const dialogRef = this.dialog.open(CreateFormComponent, {\r\n    width: '900px',\r\n      maxHeight: '90vh',\r\n      panelClass: 'custom-dialog-container',\r\n  })\r\n\r\n  dialogRef.afterClosed().subscribe(result => {\r\n    this.getAllRequests();\r\n  })\r\n}\r\n\r\nopenModal(request: any): void {\r\n  this.showDialog = true;\r\n  this.data = request;\r\n}\r\n\r\ncloseModal(): void {\r\n  this.showDialog = false;\r\n}\r\n\r\ndisapproveRequest(): void {\r\n  const payload = {\r\n    status: 'rejected',\r\n    notes: this.rejectForm.value.notes,\r\n    approvedById: this.user.id\r\n  }\r\nthis.subscriptions.push(\r\n  this.approveService.approveRequest(this.data.id, payload).subscribe(\r\n    (response) => {\r\n      this.getApprovedRequest();\r\n      this.data = {};\r\n      this.showDialog = false;\r\n    },\r\n    (error) => {\r\n      console.log(error);\r\n    }\r\n  )\r\n)\r\n}\r\n\r\napproveRequest(): void {\r\n  const payload = {\r\n    status: 'approved',\r\n    approveNoOfPos: this.rejectForm.value.approveNoOfPos,\r\n    notes: this.rejectForm.value.notes,\r\n    approvedById: this.user.id\r\n  }\r\nthis.subscriptions.push(\r\n  this.approveService.approveRequest(this.data.id, payload).subscribe(\r\n    (response) => {\r\n      this.getApprovedRequest();\r\n      this.data = {};\r\n      this.showDialog = false;\r\n    },\r\n    (error) => {\r\n      console.log(error);\r\n    }\r\n  )\r\n)\r\n}\r\n\r\n\r\n}\r\n"
        }
    ]
}